<?xml version="1.0" encoding="UTF-8"?>
<api context="/payment" name="PaymentAPI" xmlns="http://ws.apache.org/ns/synapse">
  <resource methods="POST" protocol="http">
    <inSequence>
      <property expression="json-eval($.amountTransaction.endUserId)"
        name="endUserId" scope="default" type="STRING"/>
      <property
        expression="json-eval($.amountTransaction.paymentAmount.chargingInformation.amount)"
        name="chargeAmount" scope="default" type="STRING"/>
      <property
        expression="get-property('query.param.isUserInfoEnabled')"
        name="isUserInfoEnabled" scope="default" type="STRING"/>
      <filter description="" regex="true" source="get-property('isUserInfoEnabled')">
        <then>
          <enrich>
            <source clone="true" type="body"/>
            <target property="InitialMessage" type="property"/>
          </enrich>
          <sequence key="dbLookupSeq"/>
        </then>
        <else>
          <sequence key="checkLimitSeq"/>
        </else>
      </filter>
    </inSequence>
    <outSequence>
      <respond/>
    </outSequence>
    <faultSequence/>
  </resource>
</api>
